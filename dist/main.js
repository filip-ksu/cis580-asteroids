!function(t){var s={};function i(e){if(s[e])return s[e].exports;var h=s[e]={i:e,l:!1,exports:{}};return t[e].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var h in t)i.d(e,h,function(s){return t[s]}.bind(null,h));return e},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="",i(i.s=0)}([function(t,s,i){"use strict";i.r(s);class e{constructor(t,s,i,e,h,a,r){this.ROTATION_SPEED=3,this.MAX_SPEED=8,this.x=t,this.y=s,this.width=i,this.height=e,this.colour=h,this.canvasWidth=a,this.canvasHeight=r,this.rotation=90,this.speedX=0,this.speedY=0,this.accelerate=!1}drawSelf(t){let s=Math.sin(this.rotation/180*Math.PI),i=Math.cos(this.rotation/180*Math.PI),e=this.width/2,h=this.height/2;this.accelerate&&(t.fillStyle="#ff7f00",t.beginPath(),t.moveTo(this.x-e*i-h*s,this.y+h*i-e*s),t.lineTo(this.x-h/2*s,this.y+h/2*i),t.lineTo(this.x+e*i-h*s,this.y+h*i+e*s),t.lineTo(this.x-h/2*3*s,this.y+h/2*3*i),t.closePath(),t.fill()),t.fillStyle=this.colour,t.beginPath(),t.moveTo(this.x-e*i-h*s,this.y+h*i-e*s),t.lineTo(this.x+h*s,this.y-h*i),t.lineTo(this.x+e*i-h*s,this.y+h*i+e*s),t.lineTo(this.x-h/2*s,this.y+h/2*i),t.closePath(),t.fill()}update(t){this.accelerate=t.up,this.updateRotation(t),this.updateSpeed(t),this.updatePosition()}updateRotation(t){t.right&&(this.rotation+=this.ROTATION_SPEED),t.left&&(this.rotation-=this.ROTATION_SPEED),this.rotation%=360,this.rotation<0&&(this.rotation+=360)}updateSpeed(t){let s=Math.sin(this.rotation/180*Math.PI),i=Math.cos(this.rotation/180*Math.PI),e=Math.sqrt(this.speedX*this.speedX+this.speedY*this.speedY);t.up&&e<this.MAX_SPEED?(this.speedX+=.1*s,this.speedY-=.1*i):(this.speedX*=.995,this.speedY*=.995)}updatePosition(){this.x+=this.speedX,this.y+=this.speedY,this.x>this.canvasWidth&&(this.x-=this.canvasWidth),this.x<0&&(this.x+=this.canvasWidth),this.y>this.canvasHeight&&(this.y-=this.canvasHeight),this.y<0&&(this.y+=this.canvasHeight)}inColisonWith(){return!1}}class h{constructor(t,s,i,e,h){this.MAX_SPEED=1+i/2,this.x=Math.random()*e,this.y=Math.random()*h,this.radius=t,this.colour=s,this.canvasWidth=e,this.canvasHeight=h,this.speedX=Math.random()*this.MAX_SPEED*2-this.MAX_SPEED;let a=Math.sqrt(this.MAX_SPEED*this.MAX_SPEED-this.speedX*this.speedX);this.speedY=Math.random()*a*2-a}drawSelf(t){t.fillStyle=this.colour,t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill()}update(){this.updatePosition()}updatePosition(){this.x+=this.speedX,this.y+=this.speedY,this.x>this.canvasWidth&&(this.x-=this.canvasWidth),this.x<0&&(this.x+=this.canvasWidth),this.y>this.canvasHeight&&(this.y-=this.canvasHeight),this.y<0&&(this.y+=this.canvasHeight)}checkColision(t){}isHitByLaser(t){return!(Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))>this.radius+t.LENGTH/2)}}class a{constructor(t,s,i,e,h,a){this.SPEED=10,this.LENGTH=10,this.x=t,this.y=s,this.direction=i,this.colour=e,this.canvasWidth=h,this.canvasHeight=a;let r=Math.sin(i/180*Math.PI),n=Math.cos(i/180*Math.PI);this.speedX=this.SPEED*r,this.speedY=this.SPEED*-n}drawSelf(t){let s=Math.sin(this.direction/180*Math.PI),i=Math.cos(this.direction/180*Math.PI);t.fillStyle=this.colour,t.beginPath(),t.moveTo(this.x+this.LENGTH/2*s,this.y-this.LENGTH/2*i),t.lineTo(this.x-this.LENGTH/2*s,this.y+this.LENGTH/2*i),t.stroke()}update(){return this.updatePosition()}updatePosition(){return this.x+=this.speedX,this.y+=this.speedY,!(this.x>this.canvasWidth)&&(!(this.x<0)&&(!(this.y>this.canvasHeight)&&!(this.y<0)))}}new class{constructor(t,s){this.WIDTH=t,this.HEIGHT=s,this.COLOUR_PLAYER="#ffffff",this.PLAYER_WIDTH=20,this.PLAYER_HEIGHT=40,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.buffer=document.createElement("canvas"),this.bufferCtx=this.buffer.getContext("2d"),this.canvas.width=this.WIDTH,this.buffer.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.buffer.height=this.HEIGHT,this.player=new e(this.WIDTH/2,this.HEIGHT/2,this.PLAYER_WIDTH,this.PLAYER_HEIGHT,this.COLOUR_PLAYER,this.WIDTH,this.HEIGHT),this.INITIAL_ASTEROIDS_CNT=4,this.asteroids=[],this.lasers=[],this.level=0,this.lifes=3,this.points=0,this.currentInput={space:!1,left:!1,right:!1,up:!1,down:!1},this.previousInput={space:!1},document.body.getElementsByTagName("main")[0].appendChild(this.canvas),document.getElementById("btn-new-game").addEventListener("click",()=>this.newGame(event))}updateWorld(){for(let t=this.lasers.length-1;t>=0;t--)this.lasers[t].update()||this.lasers.splice(t,1);for(let t=0;t<this.asteroids.length;t++)this.asteroids[t].update();this.fire(),this.player.update(this.currentInput)}fire(){this.currentInput.space&&!this.previousInput.space&&(this.previousInput.space=!0,this.lasers.push(new a(this.player.x,this.player.y,this.player.rotation,this.COLOUR_PLAYER,this.WIDTH,this.HEIGHT)))}renderGame(){this.bufferCtx.clearRect(0,0,this.WIDTH,this.HEIGHT);for(let t=0;t<this.lasers.length;t++)this.lasers[t].drawSelf(this.bufferCtx);for(let t=0;t<this.asteroids.length;t++)this.asteroids[t].drawSelf(this.bufferCtx);this.player.drawSelf(this.bufferCtx),this.drawUi(),this.ctx.clearRect(0,0,this.WIDTH,this.HEIGHT),this.ctx.drawImage(this.buffer,0,0)}drawUi(){this.bufferCtx.font="40px Open-Sans",this.bufferCtx.fillStyle="#ffffff",this.bufferCtx.fillText("Lvl "+this.level,10,40),this.bufferCtx.fillText(this.points,10,90);let t=this.WIDTH-this.PLAYER_WIDTH,s=this.PLAYER_HEIGHT;this.bufferCtx.strokeStyle="#ffffff";for(let i=0;i<this.lifes;i++)this.bufferCtx.beginPath(),this.bufferCtx.moveTo(t-this.PLAYER_WIDTH/2,s+this.PLAYER_HEIGHT/2),this.bufferCtx.lineTo(t,s-this.PLAYER_HEIGHT/2),this.bufferCtx.lineTo(t+this.PLAYER_WIDTH/2,s+this.PLAYER_HEIGHT/2),this.bufferCtx.lineTo(t,s+this.PLAYER_HEIGHT/4),this.bufferCtx.closePath(),this.bufferCtx.stroke(),t-=3*this.PLAYER_WIDTH/2}checkColisions(){let t=!0;for(let s=this.asteroids.length-1;s>=0;s--){t&=!this.player.inColisonWith(this.asteroids[s]);for(let t=s-1;t>=0;t--)this.asteroids[s].checkColision(this.asteroids[t]);for(let t=this.lasers.length-1;t>=0;t--)if(this.asteroids[s].isHitByLaser(this.lasers[t])){let i=this.asteroids[s];this.asteroids.splice(s,1),this.lasers.splice(t,1),this.points+=Math.pow(Math.round(i.radius/2),2);break}}0==this.asteroids.length&&this.newLevel()}gameLoop(){this.updateWorld(),this.checkColisions(),this.renderGame(),window.requestAnimationFrame(()=>this.gameLoop())}handleKeydown(t){switch(t.key){case" ":this.currentInput.space=!0;break;case"ArrowLeft":this.currentInput.left=!0;break;case"ArrowRight":this.currentInput.right=!0;break;case"ArrowUp":this.currentInput.up=!0;break;case"ArrowDown":this.currentInput.down=!0}}handleKeyup(t){switch(t.key){case" ":this.previousInput.space=!1,this.currentInput.space=!1;break;case"ArrowLeft":this.currentInput.left=!1;break;case"ArrowRight":this.currentInput.right=!1;break;case"ArrowUp":this.currentInput.up=!1;break;case"ArrowDown":this.currentInput.down=!1}}newLevel(){this.level++;let t=this.INITIAL_ASTEROIDS_CNT+this.level*this.level/3;for(let s=0;s<t;s++)this.asteroids.push(new h(Math.random()*this.PLAYER_HEIGHT/2+this.PLAYER_HEIGHT/2,this.COLOUR_PLAYER,this.level,this.WIDTH,this.HEIGHT))}newGame(t){t.preventDefault(),confirm("Do you really want to start a new game?")&&window.location.reload()}loop(){window.addEventListener("keydown",()=>this.handleKeydown(event)),window.addEventListener("keyup",()=>this.handleKeyup(event)),this.newLevel(),this.gameLoop()}}(800,600).loop()}]);